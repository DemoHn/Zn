\documentclass{spec}

\chapter[Lexical Structure]{词法结构}

\paragraph{
  世上的编程语言，大抵采用纯文本的形式以存储代码。使用文本的优势不言自明：使用一般的文本编辑器即可阅读及编辑，
  同时亦方便托管到代码平台上进行维护，（LabView即是一个反例，其程序需要用专门的软件来查阅）\en{Zn}语言自然也不例外。
}

\paragraph{
  词法结构\enq{Lexical Structure}主要讲述的是如何用一些基本词素拼成一段\Zn 语言代码：
  所谓「连词成句」，大抵上就是这个意思。\Zn 语言主要由「标识符」\sectionrefq{Identifier}，「关键字」\sectionrefq{Keyword}，
  「立即数」\sectionrefq{Number}，「文本」\sectionrefq{String}，「注释」\sectionrefq{Comment}，
  「空格」、「换行」及「缩进」\sectionrefq{CRLF}等基本词素构成。
  这些词素的详细定义会在接下来的几个章节里给出。
}

\paragraph{
  中文编码曾经让无数程序员焦头烂额。有鉴于此，\en{Zn}语言统一要求\bold{所有程序文件须使用\enc{Unicode}字符集，以及使用\enc{UTF-8}编码}。
  \sectionrefq{Unicode}一节会详细介绍个中原因及具体细节。
}

\section[Unicode]{Unicode与UTF-8}

\paragraph{
  \en{Unicode}字符集诞生于1991年，旨在对全世界所有的文字统一进行编码。自此之后，各个操作系统逐渐支持\en{Unicode}，并
  在越来越多场合推荐使用\en{Unicode}；\en{UTF-8}是目前对\en{Unicode}字符进行编码中最流行的，它以变长编码作为其主要特点
  ，兼顾了中文和西文的编码需求，使得在不浪费编码空间的前提下做到多语言混合编码。
}

\paragraph{
  有鉴于此，\Zn 语言要求所有的程序都需要使用\en{UTF-8}编码。使用\en{GB2312}，\en{GBK}，\en{Big5}等中文编码保存文件是无法被
  解析的。事实上，大多数中文「乱码」问题都是来自于源文件采用Windows默认的GBK编码而解析文件时采用UTF-8编码导致的，所以这个规定希望
  从根源上解决乱码的问题。
}
\paragraph{
  对\enc{BOM}的支持有待验证及讨论。
}

\paragraph{关于UTF-8编码的细节可以很方便在互联网上找到，同时绝大多数文本编辑器都支持UTF-8编码，所以这里就不再赘述了。}

\section[CRLF]{换行符}

\paragraph{
  换行符在\Zn 语言中表示下一行的开始。和大多数语言一样，\en{Windows}风格的\enc{\bs r\bs n}和\en{Linux}风格的
  \enc{\bs n}都会被视作一个有效的换行符。换行符的详细定义如下所示：（\CR表示\enc{\bs r}, \unicodechar{000D}；\LF{}表示\enc{\bs n}, \unicodechar{000A}；）
}

\begin{BNF}
<换行符> ::=
    | `\CR'
    | `\LF' 
    | `\CR' `\LF'
    | `\LF' `\CR'
\end{BNF}


\paragraph{
  \Zn 语言并不要求每一行的最大长度，不过为了阅读方便起见，这里建议每一行的最大长度不要超过60个中文字。（算上缩进的话）
}

\section[WhiteSpaces]{空白符}

\paragraph{
  在\Zn 语言中，空白符一般有两个用处：表示缩进及分隔字符。和\en{Python}语言类似，\Zn 语言采用缩进以表示代码的层次。
  只有\SP（\unicodechar{0020}, 西文空格）及\TAB（\unicodechar{0009}, \enc{\bs{}t}）方可成为缩进用字符。
  缩进的具体定义会在\sectionrefq{IndentChar}一节中详细介绍。
}

\paragraph{
  当空白符作为分隔字符之用时，其使用范围比大多数编程语言要广很多。这和中文本身的语法特性有关：中文一般不会使用空白符
  来分词，这使得一个句子里面就算一个空白符都没有也不影响阅读。于是\Zn 语言借鉴了此特性，不依赖空白符分隔关键词及标识符，而是
  纯粹将空白符作为方便代码阅读之用。一般来说，以下情况皆可加入空白符而无任何影响：
}

\begin{items}
  \item{标识符内。如：\code{令马克  吐温为「作家」}}
  \item{显式标识符内。如：\code{令·彩云 之 南·为「省份」}}
  \item{立即数内。如：\code{12 0000 0000 0000 \%}}
  \item{注释头部（「注」字后面所跟的数字）。如：\code{注1 2 3：都是注释}}  
  \item{关键字、标识符、立即数之间。如：\code{令 速度 为 120km/h ； 速度 设为 130 km/h}}
\end{items}

\paragraph{而在以下情况下，加入空白符会导致非预期的后果：}
\begin{items}
  \item{多字符的关键字。如：\code{不等于} 这三个字作为关键字必须要连在一起，不能分开。}
  \item{多字符的分隔符。如：\code{==} 作为映射符号，两个等号之间不能加空白符。}
  \item{行首。在行首加入\SP 或者\TAB 等「缩进空白符」会被当作缩进本身；而加入其他空白符则会报解析失败。}
\end{items}

\paragraph{以下分别给出「空白符」及「缩进空白符」之具体定义：}

\begin{BNF}
<缩进空白符> ::=
    | `\SP'
    | `\TAB'

<空白符> ::= 
    | <缩进空白符>
    | `\unicodechar{000B}'
    | `\unicodechar{000C}'
    | `\unicodechar{00A0}'
    | `\unicodechar{2000}'
    | `\unicodechar{2001}'
    | `\unicodechar{2002}'
    | `\unicodechar{2003}'
    | `\unicodechar{2004}'
    | `\unicodechar{2005}'
    | `\unicodechar{2006}'
    | `\unicodechar{2007}'
    | `\unicodechar{2008}'
    | `\unicodechar{2009}'
    | `\unicodechar{200A}'
    | `\unicodechar{200B}'
    | `\unicodechar{202F}'
    | `\unicodechar{205F}'
    | `\unicodechar{3000}'
  }

\end{BNF}
\paragraph{一般建议直接用\SP作为空白符使用，这样方便输入以及其他人的维护。}

\section[IndentChar]{缩进}

\paragraph{如前所述，\Zn 语言使用缩进作为标识代码层次的标识。缩进并不是一个或多个固定}

\section[Punctuation]{分隔符}

\section[Identifier]{标识符}

\section[Keyword]{关键词}

\section[QuoteIdentifier]{显式标识符}

\section[Number]{立即数}

\section[String]{文本}

\section[Comment]{注释}


