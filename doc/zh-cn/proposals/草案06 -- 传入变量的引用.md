| 档案编号| 作者| 提案时间 | 状态 |
|:----:|:----:|:----:|:----:|
|〔草案06〕| DemoHn | 2020-09-16 | 已接受 |

------
2024/9/23 更新： 不再使用 & 来进行引用传递，而是用 `XXX的引用` 新建一个特别的引用对象来解决问题
------


## 简介

本草案主要规定了 Zn 语言的两种变量传递的方式：_值传递_ 及 _引用传递_。在某些情况下，使用 _引用传递_ 可以减少由于复制对象所带来的消耗以提升性能，但同时使用不好的话会给用户带来巨大的困惑；而使用 _值传递_ 虽保证了变量值不会发生意料之外的改变，但是当数据量很大时会严重影响程序性能。鉴于这两种传递方式都有实用意义，Zn 决定将选择权交给用户：用户可以自行决定用哪种方式传递变量。

## 变量的传递方式

变量有两种传递方式：**值传递** (assign by value) 及 **引用传递** (assign by reference)。为解释这两个概念，我们不妨从下面的变量声明语句说起：

```
令 标识1，标识2 为 204
```

这个语句本身的意思十分简单：声明`标识1`，`标识2`，并将 `204` 这个数值赋值给变量 `标识1` 及 `标识2`。这实际上是两个步骤：

1. 声明 `标识1`和`标识2` 的存在，并分配给一定的内存空间

    刚刚声明时， `标识1` 和 `标识2` 并没有任何对应的值。此时两个变量各自拥有独立的内存空间，不过这个空间还没有和任何的值对应，等于是一个「空」的状态。

2. 将 `204` 这个数值赋值给 `标识1` 和 `标识2`

    `204` 是在内存中新建立的一个值，这个值目前还没有变量所对应。唯须注意，在赋值时，实际上 `204` 在内存中被复制了一次<sup>1</sup>，`标识1` 所对应的值实际上是复制品； `标识2` 也是一样的道理。在这里，`204` 这个值完成了两次复制。

像以上例子这样，将变量值复制一份传递给新的变量名的方式便称作**值传递**。由于两个变量值不共享内存空间，当其中一个变量值发生改变时，另一个变量的值不会跟着变化。

而像 `A 为& B` 这样的即是 **引用传递**，亦即B和A享用同一个内存空间（换句话说，就是A「引用」了B的值）；当B的值发生变化时，A的值也会发生相应的变化。

以下实验可以更好的解释这两者的区别：

```
令A为【2，3，4】
令B，C为空

B 为 A    注：此为「值传递」
C 为 &A   注：此为「引用传递」

A#2 为 40    注：A的值为【2，3，40】

（显示：B）   注：B的值为【2，3，4】 （因为B的值相当于是复制过来的）
（显示：C）   注：B的值为【2，3，40】 （C和A指向同一个内存空间）
```

## 变量类型及传递方式

目前，Zn 语言一共涉及 6 种基本类型：「数值」，「文本」，「二象」，「数组」，「列表」，「对象」。

对于诸如 `A 为 B`这样的赋值语句而言，当赋值变量（aka. B）类型为「数值」，「文本」，「二象」，「数组」，「列表」之一时，使用**值传递**；而当赋值变量类型为「对象」时，使用 **引用传递**。在实际编程时可以灵活运用此特性而快速达到目的。

## 变量引用语法

如果希望变量值强制使用**引用传递**的方式传递进来，那么可以使用 `变量引用` 的语法。这些语法大多通过在语句间加 `&` 的方式来表明此变量或者此语句需要以**引用传递**的方式传入。具体可参照以下四种语法：

1. `令 〔变量名列表〕 为 & 〔变量值〕`
    
    在声明语句的「为」字后面加上「&」 表示前面声明的变量值都是后面的表达式的引用。类似的 
    ```
    令： 
        A 为 & B
        C 为 & D
        E 为 F
    ```
    这样的衍生语法也是支持的。值得注意的是，「&」符号不能连用。

2. `〔变量名〕 为 & 〔变量值〕`

    在声明语句的「为」字后面加上「&」 表示前面声明的变量值都是后面的表达式的引用。

3. `已知 &〔变量名〕， ...`

    在方法声明语句内，若是在变量名前加「&」，则表明将传入参数的引用。如 `已知 &A，&B，C，D` 这样的用法也是可以的。

4. `是为 &〔变量名〕， ...`

    在方法声明语句内，若是在变量名前加「&」，则表明在构造方法中传入参数的引用。

注意在对象定义语句中的 `其 〔变量名〕 为 〔变量值〕` 不支持上述的变量引用语法。

