| 档案编号| 作者| 提案时间 | 状态 |
|:----:|:----:|:----:|:----:|
|〔刍议08〕| DemoHn | 2020-04-11 | 已接受 |

## 简介

本草案重新设计了 Zn 语言中关于标识符的限制，使得标识符可使用的字符集范围更广，同时能够支持诸如 `下标之+1`，`鸡数之20倍`，`索引之（+2）`，`20m/s²` 这样的语法，以弥补 Zn 语言中计算表达式不足的缺陷。

## 技术草案

本草案基本的设想是将数值当作是标识符的特殊情况，并在此基础上允许讲数字 0-9 以及四则运算符（`+ - * /`）作为标识符的开头。

当标识符作为变量名使用时，又将标识符分为 `可变值` 和 `固定值` 两种。后者暗含了对应的值，如标识符 `10` 对应了`固定值` “10” ，我们显然不能指鹿为马，将标识符 `10` 的值指定为 “20”。

下面的内容讲详细阐述之。

### 扩展标识符的概念

所谓标识符，即是指标识某个事物名称的词语。这意味着，标识符的作用即是给某个元素“起个名字”。

在最初的设计里，标识符和数值是分开的，标识符的第一个字符是不允许数字存在的，否则的话对于类似标识符 `123变量名` 的理解将会出现歧义：究竟是要解析成 数值`123` 和 变量 `变量名` 还是一个标识符 `123变量名` 呢？

目前 Zn 支持给 _变量_，_属性_，_方法_ 命名，那么为何不尝试给 _数值_ 起个名字呢？正如我们可以定义一个变量，并给这个变量起名为 `变量ABC` 一样；我们亦可以定义一个数值，并给这个数值起名为 `123`。当然，为防止歧义，我们并不会给数值123起一个诸如 `456` 这样的名字。

因此我们在此给出新的合法标识符所需要的条件：

1. 原有标准中对于标识符的长度有最长32个字符的限制，现取消长度限制

2. 每一个标识符的编码应符合下列范围之一：
    - Unicode UAX#31 所定义的 XID_Continue* 属性中小于等于 U+FFFF 的部分
        > 编码范围包括了 _ (U+5F), A-Z（U+41~U+5A）, a-z（U+61~U+7A）, 0-9（U+30~U+39）, CJK统一表意文字（U+4E00~U+9FEF），日文假名，韩文谚文
    - 符号 `$ % + - * /` 之一 （分别对应 U+24 U+25 U+2A, U+2B, U+2D, U+2F）
    - 符号 `° ± ² ³` 之一（分别对应 U+B0, U+B1, U+B2, U+B3）
    - 符号 `. ^` 之一（分别对应 U+2E, U+5E）

* XID_Continue 的范围具体参考了 https://github.com/unicode-rs/unicode-xid/blob/master/src/tables.rs 中的列表，大约有四百多项，使用二分查询最多10次即可判断

3. 标识符不能和某个关键主词等同，但是可以包含某个关键词。比如 `华为手机` 即包含了 `为` 关键词，不过在实际使用时，需在标识符前后各加一个着重符号。

按照上述规则，以下皆为合法的标识符：

```
I84
eventRuleList
公交车站-数目
_WINDOW_HANDLER2
MERS/SARS病例数
一九〇八-一九七八年项目变迁
120m/s
12.5*10^2cm²
±1/2
14.5°C
25.8倍
```

### 标识符的不同用途

一般情况下，根据标识符在不同语法结构下有四种可能的情况：

1. 作为变量/常量名

    如： `令 标识名 为 空` 中，前面的 `标识名` 即作为新定义的变量的名称使用。

2. 作为类型名

    如：`定义 标识` 中的 `标识` 即定义了一个类型。

3. 作为方法名/属性名

    如：`如何 举例标识？` 中的 `举例标识` 即定义了一个方法。  
    自然 `（举例标识：A，B，C）` 及 `彼 之（举例标识：A，C）` 中的 `举例标识` 也是作为方法名存在的。

    对于属性名而言，如：`彼 之 天涯 之 海角` 中的 `天涯`，`海角` 即代表的是属性名称。

    而同时 `何为 XX？` 中的 `XX` 也是作为属性名存在的。

4. 作为列表的索引名称

    如 `令对仗表为【云 == “雨”】` 中的 `云` 即是列表的索引名称。（`云` 实际上对应的是文本 `“云”`， 需要通过 `对仗表#“云”` 来获取对应的值）

至于标识符本身可以分成三种不同的类型：

1. 数值及以数值开头的标识符 （以下简称“数值标识”）

    所谓数值即是代表了一个确定的整数或者小数。数值只支持用阿拉伯数字 (0~9) 以及小数点等符号表示，不支持中文数字。其参考正则表达式如下所示：

    ```
    [-+]?[0-9]*\.?[0-9]+((([eE][-+])|(\*(10)?\^[-+]?))[0-9]+)?
    ```    

    比如 `123.45`，`1/2`，`1.8*10^7m²` 都可以算作是数值标识

2. 全局变量名

    如 `真`，`空`，`假`。这些不属于关键词，但是其作为变量名都有固定的值，且不可更改。

3. 一般标识

    除上面所举的例子之外的所有标识符均属于一般标识。

### 标识符的使用限制

1. 全局变量名及数值标识可以做为变量/常量名使用，但是它们不能被赋予新的值。

    因为这些变量可以理解为自己带有值，如 标识 `12345` 自带对应数值 12345，自然不能被执行 `令 12345 为 10000` 这样的语句，`令真 为假` 自然也是不被允许的。

    > 本期仅支持数值，数值后面加其他字符（单位）目前作为变量名时会报错。

2. 所有标识作为方法名/属性名/列表的索引名称时，都被当作文本处理

    也就是说，诸如【123 == 0】实际上和 【“123” == 0】是一样的。  
    以及 `数之+1` 中的 `+1` 是一个属性名，和 `数之1` 是不一样的！

### 单位量的设计

本草案不准备做单位量，不过既然上面提到了“以数值开头的标识符”，那就顺便一提单位量的概念：

    所谓 `单位量`，即是指在数值后面跟上字符作为单位。
    如 `71234元/m²` 即是一个 `单位量`，其数值为 `71234`，其单位为 `元/m²`；
    事实上 `1/2` 也是一个单位量，其数值为1，其单位为 `/2`；

关于单位量和数值的计算方式之后再提，这里只是认为单位量也是标识符的一种，目前直接用 `令变量 为1250元/m²` 这样的单位是会报错的。 